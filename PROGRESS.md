# Choose the Heat - Project Progress

**Project**: Choose the Heat - AI-Enhanced Romance Novel App
**Last Updated**: 2025-11-17 | **Status**: MVP Complete + Streaming Content! üéâ
üìÑ **Details**: See [SESSION_SUMMARY.md](SESSION_SUMMARY.md) for comprehensive recap

---

## ‚úÖ Completed Phases (1-15)

### Phase 1: Foundation & Setup (100% Complete)

**Files Created:**

- [package.json](package.json) - Dependencies, scripts, and engine requirements configured
- [.nvmrc](.nvmrc) - Node 24 version specification for nvm
- [.node-version](.node-version) - Node 24 version for asdf/fnm
- [tsconfig.json](tsconfig.json) - TypeScript strict mode enabled
- [app.config.ts](app.config.ts) - TanStack Start configuration (deprecated, now uses vite.config.ts)
- [tailwind.config.js](tailwind.config.js) - Custom romance color palette
- [postcss.config.js](postcss.config.js) - PostCSS configuration
- [.env.example](.env.example) - Environment variable template
- [.gitignore](.gitignore) - Git ignore rules
- [src/styles/globals.css](src/styles/globals.css) - Global styles with Tailwind
- [src/lib/utils.ts](src/lib/utils.ts) - Utility functions (cn, formatError, etc.)

**Note:** The `app/` folder has been renamed to `src/` to match TanStack Start's expected structure.

**Key Decisions:**

- Using pnpm 9+ for package management
- Node.js 24+ for runtime
- TanStack Start for full-stack React framework
- Tailwind CSS for styling with custom romance theme
- TypeScript strict mode for maximum type safety

### Phase 2: Database Infrastructure (100% Complete)

**Files Created:**

- [src/lib/db/index.ts](src/lib/db/index.ts) - Kysely database client setup
- [src/lib/db/types.ts](src/lib/db/types.ts) - TypeScript types (generated by kysely-codegen)
- [src/lib/db/migrate.ts](src/lib/db/migrate.ts) - Migration runner script
- [src/lib/db/migrations/001_initial.ts](src/lib/db/migrations/001_initial.ts) - Initial schema
- [src/lib/db/seed.ts](src/lib/db/seed.ts) - Seed data with 4 novel templates

**Database Schema:**

```
users (id, email, name, avatar_url, default_preferences, email_verified, timestamps)
oauth_accounts (id, user_id, provider, provider_user_id, access_token, refresh_token, expires_at)
password_accounts (id, user_id, hashed_password, timestamps)
sessions (id, user_id, expires_at, created_at)
novel_templates (id, title, description, base_tropes[], estimated_scenes, cover_gradient, timestamps)
choice_points (id, template_id, scene_number, prompt_text, options[jsonb], created_at)
user_stories (id, user_id, template_id, preferences[jsonb], current_scene, status, timestamps)
choices (id, story_id, choice_point_id, selected_option, created_at)
scenes (id, story_id, scene_number, content, word_count, created_at)
```

**Seeded Templates:**

1. The CEO's Secret Arrangement (fake-dating, ceo-romance, enemies-to-lovers)
2. Moonlit Destiny (paranormal, fated-mates, forbidden-love)
3. Second Chance Summer (second-chance, small-town, childhood-friends)
4. The Highlander's Vow (time-travel, historical, forced-proximity)

**Available Scripts:**

- `pnpm db:migrate` - Run migrations
- `pnpm db:codegen` - Generate TypeScript types from schema
- `pnpm db:seed` - Seed novel templates

### Phase 3: Authentication System (100% Complete)

**Files Created:**

- [src/lib/auth/session.ts](src/lib/auth/session.ts) - Session management (create, validate, delete)
- [src/lib/auth/oauth.ts](src/lib/auth/oauth.ts) - Google OAuth with Arctic
- [src/lib/auth/password.ts](src/lib/auth/password.ts) - Argon2 password hashing and validation
- [src/lib/db/queries/users.ts](src/lib/db/queries/users.ts) - User database queries
- [src/routes/api/auth/google.ts](src/routes/api/auth/google.ts) - OAuth initiation
- [src/routes/api/auth/callback.google.ts](src/routes/api/auth/callback.google.ts) - OAuth callback
- [src/routes/api/auth/signup.ts](src/routes/api/auth/signup.ts) - Email/password signup
- [src/routes/api/auth/login.ts](src/routes/api/auth/login.ts) - Email/password login
- [src/routes/api/auth/logout.ts](src/routes/api/auth/logout.ts) - Logout endpoint
- [src/routes/auth/login.tsx](src/routes/auth/login.tsx) - Login page UI
- [src/routes/auth/signup.tsx](src/routes/auth/signup.tsx) - Signup page UI

**Authentication Features:**

- ‚úÖ Google OAuth integration (Arctic library)
- ‚úÖ Email/password authentication (Argon2 hashing)
- ‚úÖ Secure session management (httpOnly, SameSite, Secure cookies)
- ‚úÖ 30-day session expiry
- ‚úÖ Password strength validation
- ‚úÖ Account linking (OAuth + email for same user)
- ‚úÖ Beautiful login/signup UI with Google button

**Security Measures:**

- httpOnly cookies (prevent XSS)
- SameSite=Lax (CSRF protection)
- Secure flag for HTTPS
- Argon2 password hashing (memory-hard)
- State validation for OAuth (prevent CSRF)

### Phase 3.5: AI Integration (100% Complete)

**Files Created:**

- [src/lib/ai/client.ts](src/lib/ai/client.ts) - Vercel AI SDK client wrapper with OpenAI
- [src/lib/ai/prompts.ts](src/lib/ai/prompts.ts) - Prompt template builders
- [src/lib/ai/generate.ts](src/lib/ai/generate.ts) - Scene generation logic
- [src/lib/db/queries/stories.ts](src/lib/db/queries/stories.ts) - Story queries
- [src/lib/db/queries/scenes.ts](src/lib/db/queries/scenes.ts) - Scene queries

**AI Features:**

- ‚úÖ Vercel AI SDK integration with multiple providers
- ‚úÖ **4 AI providers supported:** OpenAI, Google Gemini, Anthropic Claude, Mistral AI
- ‚úÖ Provider-agnostic interface (easy to switch between providers)
- ‚úÖ Model customization per provider via environment variables
- ‚úÖ Built-in streaming support and error handling
- ‚úÖ Dynamic system prompts based on user preferences
- ‚úÖ Scene generation with context from previous scenes
- ‚úÖ Choice impact reflection in story
- ‚úÖ Story progression awareness (beginning, middle, climax, resolution)
- ‚úÖ Scene caching in database (avoid regeneration costs)
- ‚úÖ Validation for scene quality (word count, no placeholders)
- ‚úÖ Comprehensive provider documentation ([AI_PROVIDERS.md](AI_PROVIDERS.md))

**Prompt Template Features:**

- Adjusts for spice level (1-5 scale)
- Incorporates chosen tropes naturally
- Adjusts pacing (slow-burn vs fast-paced)
- Uses context from last 2 scenes
- Reflects previous choice impacts
- Sets up choice points naturally

### Phase 4: User Onboarding Flow (100% Complete)

**Files Created:**

- [src/lib/types/preferences.ts](src/lib/types/preferences.ts) - Preference type definitions
- [src/routes/auth/onboarding.tsx](src/routes/auth/onboarding.tsx) - 3-step onboarding UI
- [src/routes/api/preferences.ts](src/routes/api/preferences.ts) - Preferences API (GET/POST)

**Onboarding Features:**

- ‚úÖ Multi-step form with progress indicator
- ‚úÖ Step 1: Genre selection (6 options)
- ‚úÖ Step 2: Trope selection (9 romance tropes)
- ‚úÖ Step 3: Spice level (1-5 with flame icons) and pacing
- ‚úÖ Form validation with Zod
- ‚úÖ Beautiful UI with animations
- ‚úÖ Saves to `users.default_preferences` as JSONB
- ‚úÖ Redirects to browse page on completion

**Auth Flow Updates:**

- Login checks for preferences and redirects appropriately
- Signup redirects to onboarding
- Google OAuth handles onboarding redirect

### Phase 5: User Profile Management (100% Complete)

**Files Created:**

- [src/routes/profile.tsx](src/routes/profile.tsx) - Profile management page
- [src/routes/api/profile/index.ts](src/routes/api/profile/index.ts) - GET/PATCH profile
- [src/routes/api/profile/password.ts](src/routes/api/profile/password.ts) - POST password change

**Profile Features:**

- ‚úÖ Profile information editing (name, email)
- ‚úÖ Email uniqueness validation
- ‚úÖ Password change with verification
- ‚úÖ Password strength validation
- ‚úÖ Preferences link to re-onboarding
- ‚úÖ Account deletion with confirmation modal
- ‚úÖ Password verification for sensitive operations
- ‚úÖ Cascade deletion of all user data
- ‚úÖ Session cleanup on account deletion
- ‚úÖ Navigation links from Browse and Library pages

### Phase 6: Novel Template System (100% Complete)

**Files Created:**

- [src/components/NovelCard.tsx](src/components/NovelCard.tsx) - Template card component
- [src/routes/browse.tsx](src/routes/browse.tsx) - Browse templates page
- [src/routes/template/$id.tsx](src/routes/template/$id.tsx) - Template detail page
- [src/routes/api/templates/index.ts](src/routes/api/templates/index.ts) - GET all templates
- [src/routes/api/templates/$id.ts](src/routes/api/templates/$id.ts) - GET template by ID
- [src/lib/db/queries/templates.ts](src/lib/db/queries/templates.ts) - Template queries

**Template System Features:**

- ‚úÖ NovelCard component with gradient covers and trope badges
- ‚úÖ Browse page with search functionality
- ‚úÖ Filter by tropes (multiple selection)
- ‚úÖ Combined search + trope filtering
- ‚úÖ Template detail page with full information
- ‚úÖ Choice points preview with options
- ‚úÖ Statistics display (scenes, key decisions)
- ‚úÖ "Start Your Story" CTA buttons
- ‚úÖ Responsive grid layout (1/2/3 columns)

### Phase 7: Story Creation (100% Complete)

**Files Created:**

- [src/routes/story/create.tsx](src/routes/story/create.tsx) - Story creation page
- [src/routes/api/stories/index.ts](src/routes/api/stories/index.ts) - POST create story
- [src/lib/db/migrations/002_add_story_title.ts](src/lib/db/migrations/002_add_story_title.ts) - Title migration

**Story Creation Features:**

- ‚úÖ Template selection and detail loading
- ‚úÖ Per-story preference overrides (spice level, pacing)
- ‚úÖ Custom story title input (optional)
- ‚úÖ Smart auto-generated title with counter
- ‚úÖ Duplicate template warning
- ‚úÖ Real-time title preview
- ‚úÖ Preference fetching from user defaults
- ‚úÖ Story record creation in database
- ‚úÖ Loading and error states
- ‚úÖ Cancel and Start Reading buttons

### Phase 8: Library Management (100% Complete)

**Files Created:**

- [src/routes/library.tsx](src/routes/library.tsx) - User's story library
- [src/routes/api/stories/user.ts](src/routes/api/stories/user.ts) - GET user's stories

**Library Features:**

- ‚úÖ Tabs for "In Progress" and "Completed" stories
- ‚úÖ Story cards with progress tracking
- ‚úÖ Progress bar with percentage completion
- ‚úÖ Creation date display ("Started Nov 10, 2025")
- ‚úÖ Custom story titles
- ‚úÖ Continue Reading / Read Again buttons
- ‚úÖ Empty state with CTA to browse
- ‚úÖ Loading and error states
- ‚úÖ React Query caching per tab
- ‚úÖ Responsive grid layout

### Phase 9: Reading Interface (100% Complete)

**Files Created:**

- [src/routes/story/$id/read.tsx](src/routes/story/$id/read.tsx) - Main reading page
- [src/routes/api/stories/$id/scene.ts](src/routes/api/stories/$id/scene.ts) - GET scene + PATCH progress
- [src/routes/api/stories/$id/choose.ts](src/routes/api/stories/$id/choose.ts) - POST record choice

**Reading Features:**

- ‚úÖ Scene display with prose content
- ‚úÖ AI scene generation on-demand
- ‚úÖ Scene caching to database
- ‚úÖ Choice selector (3 options at choice points)
- ‚úÖ "Continue to Next Scene" button for non-choice scenes
- ‚úÖ Progress tracking and updates
- ‚úÖ Scene navigation (next/previous buttons)
- ‚úÖ Progress bar with scene tracking
- ‚úÖ Back to Library button
- ‚úÖ Loading states for AI generation
- ‚úÖ Error handling and display
- ‚úÖ Choice point detection
- ‚úÖ Story completion detection

**Bug Fixes:**

- ‚úÖ Fixed next scene button logic (was always disabled)
- ‚úÖ Added continue button for scenes without choices
- ‚úÖ Fixed duplicate key constraint race condition in cacheScene()

### Phase 10: Core Routes & Landing Page (100% Complete)

**Files Created:**

- [src/router.tsx](src/router.tsx) - Router configuration
- [src/routes/\_\_root.tsx](src/routes/__root.tsx) - Root layout with React Query
- [src/routes/index.tsx](src/routes/index.tsx) - Landing page (hero + features)

**Note:** `client.tsx` and `ssr.tsx` removed in TanStack Start migration

### Phase 11: Docker Setup (100% Complete)

**Files Created:**

- [Dockerfile](Dockerfile) - Multi-stage build for optimal image size
- [docker-compose.yml](docker-compose.yml) - Orchestrates app, PostgreSQL, and Redis
- [docker-entrypoint.sh](docker-entrypoint.sh) - Runs migrations on startup
- [.dockerignore](.dockerignore) - Excludes unnecessary files from build
- [DOCKER.md](DOCKER.md) - Complete Docker setup documentation
- [.env.example](.env.example) - Unified environment template (works for both local & Docker)

**Docker Features:**

- ‚úÖ Multi-stage Dockerfile (deps ‚Üí builder ‚Üí runner)
- ‚úÖ PostgreSQL 14 with persistent volume
- ‚úÖ Redis 7 with persistent volume
- ‚úÖ Health checks for all services
- ‚úÖ Automatic migrations on startup
- ‚úÖ Optional database seeding
- ‚úÖ Non-root user for security
- ‚úÖ Unified .env template (works for both local dev & Docker)

**Services:**

- **app**: Node.js application on port 3000
- **postgres**: PostgreSQL database on port 5432
- **redis**: Redis cache on port 6379

**Quick Start:**

```bash
cp .env.example .env
# Edit .env with API keys (comment out DATABASE_URL/REDIS_URL for Docker)
docker-compose up --build
```

### Phase 12: AI Prompt Enhancement & Metadata System (100% Complete)

**Files Created:**

- [src/lib/db/migrations/003_add_scene_metadata.ts](src/lib/db/migrations/003_add_scene_metadata.ts) - Metadata storage
- [SCENE_METADATA.md](SCENE_METADATA.md) - Metadata system documentation

**Files Enhanced:**

- [src/lib/ai/prompts.ts](src/lib/ai/prompts.ts) - Comprehensive prompt improvements
- [src/lib/ai/generate.ts](src/lib/ai/generate.ts) - Metadata integration
- [src/lib/db/queries/scenes.ts](src/lib/db/queries/scenes.ts) - Metadata storage & retrieval

**Prompt Enhancement Features:**

- ‚úÖ Enhanced system prompts with protagonist traits and setting preferences
- ‚úÖ Expanded consent guidelines (mutual desire, gradual escalation)
- ‚úÖ Comprehensive DO NOT section (18+ age requirement, prohibited content)
- ‚úÖ Phase-aware scene objectives (5 phases with specific guidance)
- ‚úÖ Variable word count targets by story phase (350-900 words)

**Metadata System Features:**

- ‚úÖ SCENE_META XML-style block parsing
- ‚úÖ Structured metadata capture (emotional_beat, tension_threads, relationship_progress, key_moment)
- ‚úÖ JSONB storage in scenes table with optional fields
- ‚úÖ Smart summary generation from metadata (97% token reduction: 60 tokens vs 2000 tokens)
- ‚úÖ Backward compatibility with 19 existing scenes (nullable columns)
- ‚úÖ Metadata retrieval functions (single scene + progression analysis)
- ‚úÖ Heuristic fallback for scenes without metadata

**Database Changes:**

- ‚úÖ Migration 003 applied to Docker PostgreSQL
- ‚úÖ Added `metadata` (JSONB) column to scenes table
- ‚úÖ Added `summary` (TEXT) column to scenes table

### Phase 13: Scene Length Control Feature (100% Complete)

**Files Enhanced:**

- [src/lib/types/preferences.ts](src/lib/types/preferences.ts) - Scene length types & constants
- [src/lib/ai/prompts.ts](src/lib/ai/prompts.ts) - Dynamic word count calculation
- [src/routes/auth/onboarding.tsx](src/routes/auth/onboarding.tsx) - Scene length selector UI
- [src/routes/story/create.tsx](src/routes/story/create.tsx) - Per-story length override UI

**Scene Length Features:**

- ‚úÖ 3 preset options: Short (0.65x), Medium (1.0x), Long (1.4x)
- ‚úÖ getSceneLengthRange() function with multipliers
- ‚úÖ Phase-aware word count adjustments (350-900 base √ó multiplier)
- ‚úÖ Onboarding UI with radio button selector in Step 3
- ‚úÖ Story creation UI with 3-column grid layout
- ‚úÖ Word count estimates displayed for each option
- ‚úÖ Per-story override capability (uses override ‚Üí user default ‚Üí "medium")
- ‚úÖ Future-ready architecture for custom word count input

### Phase 14: Preferences Management Page (100% Complete)

**Files Enhanced:**

- [src/routes/preferences.tsx](src/routes/preferences.tsx) - Complete redesign from wizard to settings page
- [src/routes/profile.tsx](src/routes/profile.tsx) - Updated navigation links and scene length display

**Preferences Page Features:**

- ‚úÖ Single-page form layout (no wizard steps)
- ‚úÖ All preference sections visible at once
- ‚úÖ Loading state with spinner while fetching preferences
- ‚úÖ Success message with auto-hide (3 seconds)
- ‚úÖ Form validation (requires at least one genre and trope)
- ‚úÖ Settings-focused UI with proper navigation
- ‚úÖ Back to Profile link and Cancel/Save buttons
- ‚úÖ No redirect on save (stays on preferences page)
- ‚úÖ Changes clear success message for better UX
- ‚úÖ Profile page integration:
  - Links to `/preferences` instead of onboarding
  - Displays scene length preference in 3-column grid
  - Shows current preferences with formatted display

**User Flow:**

1. User navigates to Profile page
2. Clicks "Update Preferences" button
3. Preferences page loads with current settings
4. User modifies preferences (genres, tropes, spice, pacing, scene length)
5. Clicks "Save Preferences" or "Cancel"
6. Returns to Profile page with updated preferences displayed

**Word Count Ranges by Phase/Length:**

| Phase         | Short   | Medium  | Long     |
| ------------- | ------- | ------- | -------- |
| Beginning     | 230-390 | 350-600 | 490-840  |
| Development   | 295-455 | 450-700 | 630-980  |
| Turning Point | 360-520 | 550-800 | 770-1120 |
| Climax        | 425-585 | 650-900 | 910-1260 |
| Resolution    | 260-420 | 400-650 | 560-910  |

---

### Phase 15: Admin Dashboard System (100% Backend Complete)

**Files Created:**

- [src/lib/db/migrations/004_add_roles_and_template_status.ts](src/lib/db/migrations/004_add_roles_and_template_status.ts) - Role system and template status
- [src/lib/db/migrations/005_add_audit_logs.ts](src/lib/db/migrations/005_add_audit_logs.ts) - Audit logging infrastructure
- [src/lib/auth/authorization.ts](src/lib/auth/authorization.ts) - Role-based access control
- [src/lib/db/queries/audit.ts](src/lib/db/queries/audit.ts) - Audit log management
- [src/lib/jobs/cleanup-audit-logs.ts](src/lib/jobs/cleanup-audit-logs.ts) - Automated log cleanup
- [src/routes/api/admin/templates/index.ts](src/routes/api/admin/templates/index.ts) - Template list/create
- [src/routes/api/admin/templates/$id.ts](src/routes/api/admin/templates/$id.ts) - Template update/delete
- [src/routes/api/admin/templates/$id.status.ts](src/routes/api/admin/templates/$id.status.ts) - Template status management
- [src/routes/api/admin/users/index.ts](src/routes/api/admin/users/index.ts) - User list
- [src/routes/api/admin/users/$id.ts](src/routes/api/admin/users/$id.ts) - User management
- [src/routes/api/admin/dashboard.ts](src/routes/api/admin/dashboard.ts) - Dashboard statistics
- [src/routes/api/admin/audit-logs.ts](src/routes/api/admin/audit-logs.ts) - Audit log viewer

**Files Enhanced:**

- [src/lib/auth/session.ts](src/lib/auth/session.ts) - Added role to SessionUser
- [src/lib/db/queries/templates.ts](src/lib/db/queries/templates.ts) - Template CRUD with audit logging
- [src/lib/db/queries/users.ts](src/lib/db/queries/users.ts) - User management with audit logging
- [src/lib/db/seed.ts](src/lib/db/seed.ts) - Admin user creation from env variables
- [src/routes/api/templates/index.ts](src/routes/api/templates/index.ts) - Filter by published status only
- [.env.example](.env.example) - Added admin configuration
- [package.json](package.json) - Added cleanup:audit-logs script

**Database Changes:**

- ‚úÖ Migration 004: Added `role` column to users (user, editor, admin)
- ‚úÖ Migration 004: Added `status` column to novel_templates (draft, published, archived)
- ‚úÖ Migration 004: Added `archived_at` and `archived_by` tracking columns
- ‚úÖ Migration 005: Created `admin_audit_logs` table for change tracking
- ‚úÖ Indexes added for efficient role and status queries

**Backend Features:**

**Authorization System:**

- ‚úÖ Role-based middleware (`requireAdmin`, `requireEditorOrAdmin`, `requireAuth`)
- ‚úÖ User role management (user ‚Üí editor ‚Üí admin)
- ‚úÖ Proper 401/403 error responses

**Audit Logging:**

- ‚úÖ Automatic logging of all admin/editor actions
- ‚úÖ Change tracking for templates and users
- ‚úÖ 3-month retention policy with cleanup job
- ‚úÖ Filterable audit log retrieval

**Template Management (Editor/Admin):**

- ‚úÖ Create templates with draft/published/archived status
- ‚úÖ Update all template fields
- ‚úÖ Archive templates (keeps existing stories intact)
- ‚úÖ Delete templates (admin only)
- ‚úÖ View all templates including drafts/archived

**User Management (Admin Only):**

- ‚úÖ List all users with pagination and search
- ‚úÖ Update user email, name, and role
- ‚úÖ Delete users (with cascade)
- ‚úÖ Self-deletion protection
- ‚úÖ User count by role statistics

**Dashboard:**

- ‚úÖ Role-specific statistics
- ‚úÖ Template counts by status (editors + admins)
- ‚úÖ User counts by role (admins only)

**Admin Seed:**

- ‚úÖ First admin user created from environment variables
- ‚úÖ Credentials: ADMIN_EMAIL, ADMIN_PASSWORD, ADMIN_NAME

**Public API Protection:**

- ‚úÖ Browse page only shows published templates
- ‚úÖ Archived templates hidden but user stories preserved
- ‚úÖ Draft templates only visible to editors/admins

**Scripts:**

- ‚úÖ `pnpm cleanup:audit-logs [days]` - Delete old audit logs (default 90 days)

**Role Permissions:**

| Feature | User | Editor | Admin |
|---------|------|--------|-------|
| Browse published templates | ‚úÖ | ‚úÖ | ‚úÖ |
| Create stories | ‚úÖ | ‚úÖ | ‚úÖ |
| View draft/archived templates | ‚ùå | ‚úÖ | ‚úÖ |
| Create templates | ‚ùå | ‚úÖ | ‚úÖ |
| Edit templates | ‚ùå | ‚úÖ | ‚úÖ |
| Archive templates | ‚ùå | ‚úÖ | ‚úÖ |
| Delete templates | ‚ùå | ‚ùå | ‚úÖ |
| View users | ‚ùå | ‚ùå | ‚úÖ |
| Edit user details | ‚ùå | ‚ùå | ‚úÖ |
| Change user roles | ‚ùå | ‚ùå | ‚úÖ |
| Delete users | ‚ùå | ‚ùå | ‚úÖ |
| View audit logs | ‚ùå | ‚ùå | ‚úÖ |

**API Endpoints:**

**Templates:**

- `GET /api/admin/templates` - List all templates (with status filter)
- `POST /api/admin/templates` - Create new template
- `GET /api/admin/templates/:id` - Get single template
- `PATCH /api/admin/templates/:id` - Update template
- `PATCH /api/admin/templates/:id/status` - Change template status
- `DELETE /api/admin/templates/:id` - Delete template (admin only)

**Users:**

- `GET /api/admin/users` - List users (pagination + filters)
- `GET /api/admin/users/:id` - Get user details
- `PATCH /api/admin/users/:id` - Update user (email, name, role)
- `DELETE /api/admin/users/:id` - Delete user

**Dashboard:**

- `GET /api/admin/dashboard` - Get role-based statistics

**Audit Logs:**

- `GET /api/admin/audit-logs` - Get audit logs (filters + pagination)

**Status:** Backend 100% complete. Frontend UI pending.

**Next Steps:**

- Admin UI components (Layout, Navigation, Tables, Forms)
- Admin dashboard page
- Template management pages
- User management pages
- Audit log viewer
- Header navigation update

### Phase 15.5: Story Card Component & Story Info Page (100% Complete)

**Files Created:**

- [src/components/StoryCard.tsx](src/components/StoryCard.tsx) - Reusable story card component
- [src/routes/story/$id.info.tsx](src/routes/story/$id.info.tsx) - Story information page
- [src/hooks/useStoryQuery.ts](src/hooks/useStoryQuery.ts) - Query hook for fetching single story

**Files Enhanced:**

- [src/routes/library.tsx](src/routes/library.tsx) - Refactored to use StoryCard component
- [src/routes/story/$id.read.tsx](src/routes/story/$id.read.tsx) - Added Info link in header
- [src/components/NovelCard.tsx](src/components/NovelCard.tsx) - Made cover image clickable
- [src/lib/api/types.ts](src/lib/api/types.ts) - Added preferences field to UserStory interface

**Component Refactoring Features:**

- ‚úÖ StoryCard component extracted from library page
- ‚úÖ Clickable cover image that navigates to reading page
- ‚úÖ Info button to view story settings and preferences
- ‚úÖ Reusable across all story list views
- ‚úÖ Consistent styling with NovelCard
- ‚úÖ Reduced code duplication (65 lines ‚Üí component-based)

**Story Info Page Features:**

- ‚úÖ Beautiful dedicated page showing all story details
- ‚úÖ Story header with cover, title, and description
- ‚úÖ Creation date and estimated scenes display
- ‚úÖ Visual progress bar showing reading completion
- ‚úÖ Story settings section displaying:
  - Spice Level (with flame icon and description)
  - Pacing preference (slow-burn or fast-paced)
  - Scene Length preference (with word count ranges)
  - Selected Genres (as styled tags)
  - Selected Tropes (as styled tags)
- ‚úÖ Continue Reading button for easy navigation
- ‚úÖ API integration using existing `/api/stories/$id` endpoint
- ‚úÖ Loading and error states

**UX Improvements:**

- ‚úÖ NovelCard cover images now clickable (navigate to template)
- ‚úÖ StoryCard cover images clickable (navigate to reading)
- ‚úÖ Info link accessible from:
  - Library page (StoryCard component)
  - Reading page (header navigation)
- ‚úÖ Users can now review their story customization at any time

**Architecture:**

- ‚úÖ Leverages existing API endpoint (no new backend needed)
- ‚úÖ Type-safe with UserPreferences parsing
- ‚úÖ Handles JSON and object preferences formats
- ‚úÖ React Query caching for optimal performance

**Benefits:**

- Users can see what preferences they chose when creating a story
- Better transparency of story settings during reading
- Improved component reusability and maintainability
- Consistent UX patterns across template and story cards

### Phase 15.6: Story Branching System (100% Complete)

**Files Created:**

- [src/routes/api/stories/$id.branch.ts](src/routes/api/stories/$id.branch.ts) - Story branching API endpoint
- [src/components/BranchConfirmationDialog.tsx](src/components/BranchConfirmationDialog.tsx) - Branch confirmation dialog component
- [src/hooks/useBranchStoryMutation.ts](src/hooks/useBranchStoryMutation.ts) - Branch story mutation hook

**Files Enhanced:**

- [src/lib/db/queries/stories.ts](src/lib/db/queries/stories.ts) - Added `findExistingBranch()` and `branchStory()` functions
- [src/routes/story/$id.read.tsx](src/routes/story/$id.read.tsx) - Integrated branching UI with previous choice display
- [src/routes/api/stories/$id.scene.ts](src/routes/api/stories/$id.scene.ts) - Enhanced to include previous choice information
- [src/routes/api/stories/$id.choose.ts](src/routes/api/stories/$id.choose.ts) - Updated to include currentScene in response
- [src/components/StoryCard.tsx](src/components/StoryCard.tsx) - Added branched story indicator with parent story link

**Story Branching Features:**

- ‚úÖ Create alternative story branches from any choice point
- ‚úÖ Duplicate detection (prevents creating identical branches)
- ‚úÖ Visual indicators showing:
  - Previous choice made at current scene
  - Branch creation option when previous choice exists
  - Parent story information for branched stories
- ‚úÖ Branch confirmation dialog with:
  - Parent story title display
  - Branch point scene number
  - Previous and new choice comparison
  - Warning about existing identical branch (if found)
- ‚úÖ Automatic data inheritance:
  - Copies all scenes up to branch point
  - Copies all choices before branch point
  - Records new choice at branch point
  - Inherits template and preferences from parent
- ‚úÖ Smart title generation (e.g., "Original Title (Branch)")
- ‚úÖ Branched story tracking in library with parent story display

**Database Operations:**

- ‚úÖ `findExistingBranch()` - Detects duplicate branches to prevent redundant stories
- ‚úÖ `branchStory()` - Transactional branching with full data copy
- ‚úÖ Proper foreign key relationships (branched_from_story_id, branched_at_scene)
- ‚úÖ Validates choice differences and scene boundaries
- ‚úÖ Ownership verification throughout

**API Endpoints:**

- ‚úÖ `POST /api/stories/:id/branch` - Creates new branched story
  - Validates choice point and new choice option
  - Checks for existing identical branches
  - Returns branch ID or existing branch information
- ‚úÖ Enhanced scene endpoint to include previous choice context
- ‚úÖ Enhanced choice endpoint to include current scene in response

**UI/UX Features:**

- ‚úÖ Previous choice display with distinctive styling
- ‚úÖ "Try Different Choice" button appears when viewing scenes with previous choices
- ‚úÖ Beautiful confirmation dialog with clear before/after comparison
- ‚úÖ Branched story badge in library (GitBranch icon)
- ‚úÖ Parent story link for easy navigation
- ‚úÖ Loading states during branch creation
- ‚úÖ Error handling and user feedback
- ‚úÖ Responsive design across devices

**User Flow:**

1. User reads story and makes choices
2. Later, user revisits a scene with a choice
3. Previous choice is displayed with context
4. "Try Different Choice" button appears
5. User clicks and selects alternative choice
6. Confirmation dialog shows:
   - Story details
   - Branch point
   - Choice comparison
   - Warning if identical branch exists
7. If confirmed, new branched story is created
8. User is navigated to the new branch to continue reading
9. Library shows both original and branched stories
10. Branched stories display parent story information

**Benefits:**

- Explore alternative storylines without losing original progress
- See "what if" scenarios for different choices
- Efficient data reuse (shared scenes/choices up to branch point)
- Clear parent-child relationship tracking
- Prevents duplicate branches automatically

### Phase 15.7: CI/CD & Database Migrations Automation (100% Complete)

**Files Created:**

- [.github/workflows/database-migrations.yml](.github/workflows/database-migrations.yml) - GitHub Actions workflow for automated migrations
- [docs/CI_MIGRATIONS.md](docs/CI_MIGRATIONS.md) - Comprehensive CI/migrations documentation

**GitHub Actions Features:**

- ‚úÖ Automated migration file validation on PRs
- ‚úÖ Migration file naming convention checking (###_description.ts)
- ‚úÖ TypeScript compilation checks for migration files
- ‚úÖ Automatic migration execution on push to main branch
- ‚úÖ Production database integration via GitHub Secrets
- ‚úÖ Workflow status reporting and failure notifications

**Workflow Jobs:**

1. **Check Migration Files** (runs on PRs and push to main):
   - Detects added/modified migration files
   - Validates file naming conventions
   - Compiles TypeScript to catch syntax errors
   - Provides early feedback before merge

2. **Run Database Migrations** (runs on push to main only):
   - Installs dependencies
   - Executes `pnpm db:migrate`
   - Applies pending migrations to production database
   - Fails workflow if migrations encounter errors

**Security & Best Practices:**

- ‚úÖ DATABASE_URL stored as GitHub Secret
- ‚úÖ Migrations validated before execution
- ‚úÖ Testing encouraged locally before push
- ‚úÖ Clear separation between validation (PR) and execution (main)
- ‚úÖ Comprehensive documentation with troubleshooting guide

**Documentation:**

- ‚úÖ Setup requirements and prerequisites
- ‚úÖ Migration naming conventions and best practices
- ‚úÖ Step-by-step workflow trigger explanation
- ‚úÖ Troubleshooting common issues
- ‚úÖ Manual migration procedures
- ‚úÖ Rollback strategies (revert, manual, hotfix)
- ‚úÖ Security notes and monitoring guidelines

**Benefits:**

- Automated database schema updates on deployment
- Early detection of migration issues via PR checks
- Consistent migration process across environments
- Reduced manual intervention and human error
- Complete audit trail of all schema changes

### Phase 15.8: Story Title Editing (100% Complete)

**Files Created:**

- [src/hooks/useUpdateStoryTitleMutation.ts](src/hooks/useUpdateStoryTitleMutation.ts) - Story title update mutation hook

**Files Enhanced:**

- [src/lib/db/queries/stories.ts](src/lib/db/queries/stories.ts) - Added `updateStoryTitle()` function
- [src/routes/api/stories/$id.ts](src/routes/api/stories/$id.ts) - Added PATCH handler for title updates
- [src/routes/story/$id.info.tsx](src/routes/story/$id.info.tsx) - Added inline title editing UI

**Story Title Editing Features:**

- ‚úÖ Edit story title directly from story info page
- ‚úÖ Inline editing with pencil icon button
- ‚úÖ Form input with current title pre-filled
- ‚úÖ Client-side validation:
  - Non-empty title requirement
  - Maximum 255 characters
  - Real-time error display
- ‚úÖ Save/Cancel controls with proper states
- ‚úÖ Loading state during save operation
- ‚úÖ Automatic query invalidation on success

**Database Operations:**

- ‚úÖ `updateStoryTitle()` - Updates story title with ownership verification
- ‚úÖ Returns updated story data
- ‚úÖ Throws error if story not found or access denied

**API Endpoint:**

- ‚úÖ `PATCH /api/stories/:id` - Updates story title
  - Validates session and ownership
  - Zod schema validation (1-255 characters)
  - Returns updated story object
  - Error handling with detailed messages

**UI/UX Features:**

- ‚úÖ Edit button (pencil icon) next to story title
- ‚úÖ Inline form with labeled input field
- ‚úÖ Save button with checkmark icon
- ‚úÖ Cancel button with X icon
- ‚úÖ Loading spinner during save
- ‚úÖ Error message display below input
- ‚úÖ Auto-focus on edit mode
- ‚úÖ Disabled state prevents duplicate saves
- ‚úÖ Smooth transitions between view and edit modes

**User Flow:**

1. User navigates to story info page
2. Clicks pencil icon next to story title
3. Input field appears with current title
4. User modifies title
5. Clicks "Save" button
6. Title is validated and updated
7. UI returns to view mode showing new title
8. Changes reflected immediately in library

**Benefits:**

- Users can personalize story titles anytime
- Fix typos or update titles as story progresses
- No need to recreate stories for title changes
- Ownership verification ensures security
- Immediate feedback with loading/error states

---

### Phase 15.9: Real-Time Streaming Content Generation (100% Complete)

**Status**: ‚úÖ Complete (2025-11-17)

**Overview**: Implemented real-time streaming of AI-generated story content, allowing users to see their stories being written word-by-word as the AI generates them. This creates a more engaging and immersive experience while maintaining clean output by automatically filtering technical metadata.

**Implementation Files:**

- ‚úÖ `src/lib/ai/streaming.ts` - Streaming wrapper for Vercel AI SDK
- ‚úÖ `src/routes/api/stories/$id.scene.stream.ts` - SSE streaming endpoint
- ‚úÖ `src/hooks/useStreamingScene.ts` - React hook for consuming streams
- ‚úÖ `src/routes/story/$id.read.tsx` - Updated reading page with streaming UI

**Streaming Architecture:**

**Server-Side (SSE):**

- Uses Server-Sent Events for efficient one-way streaming
- Leverages Vercel AI SDK's `streamText()` function
- Smart buffering system (200-char buffer) to detect and filter `<SCENE_META>` blocks
- Streams clean narrative content only (metadata stripped in real-time)
- Sends metadata event first, then content chunks, then done event
- Caches complete scene after streaming finishes

**Client-Side Hook:**

- `useStreamingScene(storyId, sceneNumber)` hook manages streaming state
- Connects via fetch API to streaming endpoint
- Accumulates text chunks as they arrive
- Provides states: `content`, `metadata`, `isStreaming`, `isComplete`, `error`
- Handles cleanup with AbortController on unmount/navigation
- Resets state when scene changes

**Reading Page UI:**

- Header with title and progress bar appears immediately
- Content streams in paragraph by paragraph
- Loading indicator with spinning icon during generation
- No automatic scrolling (user maintains reading position)
- Choice buttons only appear after streaming completes
- "Freshly generated" badge for new content
- Word count and reading time calculated on completion

**Metadata Filtering:**

- `<SCENE_META>` blocks are never shown to users
- Buffer-based detection catches metadata before streaming
- Regex cleanup for any remaining metadata in final buffer
- Parsed metadata stored in database for context in future scenes
- Clean user experience without technical implementation details

**Performance:**

- Cached scenes: Instant load (sent immediately via SSE)
- New scenes: Real-time generation (~10-30 seconds typical)
- No artificial delays or waiting screens
- Smooth streaming with visual feedback
- Efficient SSE protocol (low overhead)

**User Experience:**

1. User navigates to a scene or clicks "Continue"
2. Header and progress bar appear instantly
3. Story content begins streaming word-by-word
4. Loading spinner shows generation is in progress
5. User can read as content appears
6. Metadata is invisible (filtered server-side)
7. When complete, choices become available
8. Scene is cached for instant future access

**Benefits:**

- More engaging experience watching AI write in real-time
- Faster perceived performance (no waiting for full generation)
- User maintains reading position (no auto-scroll)
- Clean output without technical metadata
- Cached scenes still load instantly
- Works with all AI providers (OpenAI, Google, Anthropic, Mistral, xAI)

---

## üèÅ Quick Start

```bash
pnpm install              # Install dependencies
pnpm db:migrate          # Setup database (requires PostgreSQL)
pnpm db:codegen          # Generate TypeScript types
pnpm db:seed             # Seed templates
pnpm dev                 # Development
pnpm build && pnpm start # Production
```

---

## üöß Next Phases

### Phase 16: Admin Dashboard Frontend (85% Complete)

**Files Created:**

- [src/components/admin/ChoicePointForm.tsx](src/components/admin/ChoicePointForm.tsx) - Choice point management component
- [src/routes/api/admin/templates/$id/choice-points.ts](src/routes/api/admin/templates/$id/choice-points.ts) - Choice points API
- [src/routes/api/admin/templates/bulk-delete.ts](src/routes/api/admin/templates/bulk-delete.ts) - Bulk delete templates endpoint
- [src/hooks/useUpdateChoicePointsMutation.ts](src/hooks/useUpdateChoicePointsMutation.ts) - Choice points mutation hook

**Files Enhanced:**

- [src/lib/db/queries/templates.ts](src/lib/db/queries/templates.ts) - Added `updateChoicePoints()`, `createTemplateWithChoicePoints()`, and `bulkDeleteTemplates()`
- [src/routes/api/admin/templates/index.ts](src/routes/api/admin/templates/index.ts) - Enhanced to handle choice points on creation
- [src/routes/api/admin/templates/$id.ts](src/routes/api/admin/templates/$id.ts) - Returns templates with choice points
- [src/routes/admin/templates/index.tsx](src/routes/admin/templates/index.tsx) - Added bulk delete functionality with role-based access
- [src/routes/admin/templates/new.tsx](src/routes/admin/templates/new.tsx) - Added choice point creation
- [src/routes/admin/templates/$id/edit.tsx](src/routes/admin/templates/$id/edit.tsx) - Added choice point editing
- [src/lib/api/types.ts](src/lib/api/types.ts) - Added ChoiceOption and ChoicePoint interfaces
- [src/hooks/useCreateTemplateMutation.ts](src/hooks/useCreateTemplateMutation.ts) - Enhanced to include choice points
- [src/hooks/useTemplateQuery.ts](src/hooks/useTemplateQuery.ts) - Updated to use shared types

**Choice Points Management Features:**

**Create & Edit Choice Points:**

- ‚úÖ Dynamic choice point form component with add/remove functionality
- ‚úÖ Maximum enforcement: up to (scenes - 1) choice points
- ‚úÖ Scene number selection with duplicate prevention
- ‚úÖ 2-4 options per choice point with validation
- ‚úÖ Each option has: text, tone, and impact fields
- ‚úÖ Real-time validation (client and server-side)
- ‚úÖ Separate save button for choice points vs template details

**Database Operations:**

- ‚úÖ Transaction-based updates for atomicity
- ‚úÖ `createTemplateWithChoicePoints()` for new templates
- ‚úÖ `updateChoicePoints()` with delete-and-replace strategy
- ‚úÖ Audit logging for all choice point changes
- ‚úÖ Proper JSON serialization/parsing of options

**API Endpoints:**

- ‚úÖ `POST /api/admin/templates` - Accepts optional choicePoints array
- ‚úÖ `GET /api/admin/templates/:id` - Returns template with parsed choice points
- ‚úÖ `PUT /api/admin/templates/:id/choice-points` - Update all choice points

**UI/UX Features:**

- ‚úÖ Intuitive nested forms with collapsible sections
- ‚úÖ Visual feedback for add/remove operations
- ‚úÖ Loading states during save operations
- ‚úÖ Error messages with field-level validation
- ‚úÖ Empty state with helpful instructions
- ‚úÖ Scene-based organization (choice after Scene X)

**Type Safety:**

- ‚úÖ Full TypeScript support throughout stack
- ‚úÖ Shared types between components and API
- ‚úÖ Zod validation schemas for runtime safety
- ‚úÖ Type-safe mutation hooks with React Query

**Architecture Decisions:**

- ‚úÖ Choice points saved separately from template metadata
- ‚úÖ Delete-and-replace strategy for updates (simpler than differential sync)
- ‚úÖ Transaction-based operations prevent partial updates
- ‚úÖ Client-side validation mirrors server validation

**Validation Rules:**

- ‚úÖ Minimum 2 options, maximum 4 options per choice point
- ‚úÖ All fields required (prompt text, option text/tone/impact)
- ‚úÖ Scene numbers must be unique within template
- ‚úÖ Cannot exceed (scenes - 1) total choice points

**User Flow:**

1. **Creating Template with Choice Points:**
   - Navigate to `/admin/templates/new`
   - Fill out template details (title, description, tropes, scenes, gradient)
   - Scroll to "Choice Points" section
   - Click "Add Choice Point" to add choice points
   - Select scene number, enter prompt, add 2-4 options
   - Save template (includes choice points)

2. **Editing Existing Choice Points:**
   - Navigate to `/admin/templates/:id/edit`
   - Scroll to "Choice Points" section (loads existing choice points)
   - Modify/add/remove choice points as needed
   - Click "Save Choice Points" (separate from template save)
   - Changes persisted with audit trail

**Bulk Operations Features:**

**Bulk Delete Templates (Admin Only):**

- ‚úÖ Bulk delete button in template list bulk actions toolbar
- ‚úÖ Role-based visibility (only shown to admin users)
- ‚úÖ Confirmation dialog before deletion
- ‚úÖ `bulkDeleteTemplates()` database function with audit logging
- ‚úÖ `POST /api/admin/templates/bulk-delete` API endpoint
- ‚úÖ `requireAdmin()` authorization middleware
- ‚úÖ Transaction-based deletion with cascade (choice points removed)
- ‚úÖ Deleted count reporting
- ‚úÖ Success/error feedback in UI

**Bulk Status Update (Editor/Admin):**

- ‚úÖ Bulk publish, draft, and archive buttons
- ‚úÖ Status update for multiple templates at once
- ‚úÖ Shared loading state with bulk delete

**Bulk Actions UI:**

- ‚úÖ Selection toolbar appears when templates selected
- ‚úÖ Selected count display
- ‚úÖ Clear selection button
- ‚úÖ Publish, Draft, Archive buttons (all roles)
- ‚úÖ Delete button (admin only, danger variant)
- ‚úÖ Loading states and error handling

**Completed Admin Features:**

- ‚úÖ Template creation with choice points
- ‚úÖ Template editing with choice points
- ‚úÖ Choice point CRUD operations
- ‚úÖ Bulk status updates (publish, draft, archive)
- ‚úÖ Bulk delete templates (admin only)
- ‚úÖ Role-based bulk action visibility
- ‚úÖ Type-safe API integration
- ‚úÖ Transaction-based database updates

**Pending Admin Features:**

- ‚è≥ Admin UI components (full Layout, Navigation, Tables)
- ‚è≥ Admin dashboard page with statistics
- ‚è≥ User management pages (list, edit)
- ‚è≥ Audit log viewer page
- ‚è≥ Header navigation update for admin/editor access

### Phase 17: Polish & UX (Priority 1)

- Error boundaries for better error recovery
- Loading skeletons for perceived performance
- Toast notifications
- Mobile optimization
- 404 page

### Phase 18: Advanced Features (Priority 2)

- Story export (PDF/EPUB)
- Statistics dashboard with emotional arc charts
- Story branching visualization

---

## üîß Technical Debt

**Security**: Rate limiting, content moderation, email verification, password reset, input sanitization

**Performance**: Scene pre-generation, Redis sessions, image optimization, code splitting

**Testing**: Unit, integration, E2E tests, performance benchmarks

**DevOps**: CI/CD pipeline, database backups, monitoring, error tracking (Sentry)

---

## ÔøΩ MVP Status: 100% Complete! ‚úÖ

**What Works**:

- ‚úÖ Authentication (email + Google OAuth)
- ‚úÖ User onboarding & preferences
- ‚úÖ Browse templates with filtering
- ‚úÖ Story creation & library management
- ‚úÖ Reading interface with choices
- ‚úÖ AI scene generation with metadata
- ‚úÖ Scene length control
- ‚úÖ Story deletion
- ‚úÖ Profile management
- ‚úÖ Admin template creation with choice points
- ‚úÖ Admin template editing with choice points
- ‚úÖ Bulk status updates (publish, draft, archive)
- ‚úÖ Bulk delete templates (admin only)
- ‚úÖ Choice point CRUD operations (create, read, update, delete)

**Deployed At**: `/`

---

## ÔøΩ Implementation Reference

**Authentication Flow**:

1. User signs up ‚Üí Create user ‚Üí Create session ‚Üí Redirect to `/auth/onboarding`
2. Complete onboarding ‚Üí Save preferences ‚Üí Redirect to `/browse`
3. User logs in ‚Üí Validate ‚Üí Check preferences ‚Üí Redirect appropriately

**Story Generation Flow**:

1. User selects template & configures preferences
2. Navigate to story reading page
3. Check if scene cached, if not generate with AI
4. User reads & makes choices or continues
5. Advance to next scene with choice context

**Scene Caching**: Each scene cached with unique `(story_id, scene_number)`. Last 2 scenes used as context. Previous choice impacts generation. Cache never invalidated.

**Choice Points Structure**:

```json
{
  "scene_number": 3,
  "prompt_text": "How do you respond to their unexpected proposal?",
  "options": [
    {
      "id": "option-1",
      "text": "Challenge them directly with skepticism",
      "tone": "confrontational",
      "impact": "bold"
    },
    {
      "id": "option-2",
      "text": "Express cautious interest",
      "tone": "diplomatic",
      "impact": "reserved"
    }
  ]
}
```

**Admin Choice Points Management**:

- Maximum: (estimated_scenes - 1) choice points per template
- 2-4 options per choice point (minimum 2, maximum 4)
- Each option requires: text, tone, and impact
- Scene numbers must be unique (no duplicate choices on same scene)
- Separate save operation from template details
- Transaction-based updates with audit logging

**Preference Structure**:

```json
{
  "genres": ["contemporary", "paranormal"],
  "tropes": ["enemies-to-lovers", "forced-proximity"],
  "spiceLevel": 4,
  "pacing": "slow-burn",
  "sceneLength": "medium"
}
```

**Word Count Ranges** (by phase/length):

| Phase         | Short   | Medium  | Long     |
| ------------- | ------- | ------- | -------- |
| Beginning     | 230-390 | 350-600 | 490-840  |
| Development   | 295-455 | 450-700 | 630-980  |
| Turning Point | 360-520 | 550-800 | 770-1120 |
| Climax        | 425-585 | 650-900 | 910-1260 |
| Resolution    | 260-420 | 400-650 | 560-910  |

---

## üí° Future Enhancements

Social features, custom templates, branching visualization, PDF export, mobile app, subscription tiers, community voting, text-to-speech narration, scene illustrations
